version: "3.8"

services:
  manager:
    build: ./manager
    container_name: manager
    env_file:
      - .env
    ports:
      - "5000:5000"
    networks:
      - hosting_net

  dashboard:
    build: ./dashboard
    container_name: dashboard
    networks:
      - hosting_net
    environment:
      - DEBUG=true
    command: >
      sh -c "echo 'ğŸŒ Dashboard corriendo internamente en http://dashboard:80';  nginx -g 'daemon off;'"

  proxy:
    build: ./proxy
    container_name: proxy
    depends_on:
      - dashboard
      - manager
    networks:
      - hosting_net
    ports:
      - "80:80"
    entrypoint: >
      /bin/sh -c "
        echo 'â³ Esperando a que Dashboard estÃ© listo...';
        while ! curl -s http://dashboard:80/index.html; do 
          sleep 2; 
        done;
        echo 'ğŸš€ Dashboard detectado, iniciando Proxy.';
        exec nginx -g 'daemon off;'
      "

networks:
  hosting_net:
    driver: bridge
